var ts = require('typescript');
var logger_1 = require('./logger');
var utils_1 = require("./utils");
var compiler_host_1 = require("./compiler-host");
var logger = new logger_1.default({ debug: false });
var TypeChecker = (function () {
    function TypeChecker(host, resolve, fetch) {
        this._host = host;
        this._resolve = resolve;
        this._fetch = fetch;
        this._options = Object.assign(this._host.options);
        this._options.inlineSourceMap = false;
        this._options.sourceMap = false;
        this._options.declaration = false;
        this._options.isolatedModules = false;
        this._files = new Map();
        this._declarationFiles = [];
    }
    TypeChecker.prototype.check = function (sourceName, source) {
        var file = this.registerFile(sourceName);
        this.registerSource(sourceName, source);
        return file.errors;
    };
    TypeChecker.prototype.registerDeclarationFile = function (sourceName, isDefaultLib) {
        var file = this.registerFile(sourceName, isDefaultLib);
        this._declarationFiles.push(file);
        return file;
    };
    TypeChecker.prototype.registerFile = function (sourceName, isDefaultLib) {
        var _this = this;
        if (isDefaultLib === void 0) { isDefaultLib = false; }
        if (!this._files[sourceName]) {
            var source = new Deferred();
            if (utils_1.isTypescriptDeclaration(sourceName)) {
                this._fetch(sourceName)
                    .then(function (source) {
                    _this._host.addFile(sourceName, source);
                    _this.registerSource(sourceName, source);
                });
            }
            var loaded = source.promise
                .then(function (source) { return _this.resolveDependencies(sourceName, source); })
                .then(function (depsMap) {
                _this._host.addResolutionMap(sourceName, depsMap);
                _this._files[sourceName].deps = Object.keys(depsMap)
                    .map(function (key) { return depsMap[key]; })
                    .filter(function (res) { return utils_1.isTypescript(res); })
                    .map(function (res) { return _this.registerFile(res); })
                    .concat(_this._declarationFiles);
            });
            var errors = loaded
                .then(function () { return _this.canEmit(_this._files[sourceName]); })
                .then(function () { return _this.getAllDiagnostics(_this._files[sourceName]); });
            this._files[sourceName] = {
                sourceName: sourceName,
                source: source,
                isDefaultLib: isDefaultLib,
                loaded: loaded,
                errors: errors,
                checked: false,
            };
        }
        return this._files[sourceName];
    };
    TypeChecker.prototype.registerSource = function (sourceName, source) {
        if (!this._files[sourceName])
            throw new Error(sourceName + " has not been registered");
        this._files[sourceName].source.resolve(source);
    };
    TypeChecker.prototype.resolveDependencies = function (sourceName, source) {
        var _this = this;
        var info = ts.preProcessFile(source, true);
        var references = info.referencedFiles
            .map(function (ref) {
            if ((utils_1.isAmbient(ref.fileName) && !_this._options.resolveAmbientRefs) || (ref.fileName.indexOf("/") == -1))
                return "./" + ref.fileName;
            else
                return ref.fileName;
        });
        var imports = info.importedFiles
            .map(function (imp) { return imp.fileName; });
        var refs = [].concat(references).concat(imports);
        var deps = refs.map(function (ref) { return _this._resolve(ref, sourceName); });
        return Promise.all(deps)
            .then(function (resolved) {
            return refs.reduce(function (result, ref, idx) {
                result[ref] = resolved[idx];
                return result;
            }, {});
        });
    };
    TypeChecker.prototype.canEmit = function (file, seen) {
        var _this = this;
        seen = seen || [];
        if (seen.indexOf(file) < 0) {
            seen.push(file);
            return file.loaded.then(function () { return Promise.all(file.deps.map(function (dep) { return _this.canEmit(dep, seen); })); });
        }
    };
    TypeChecker.prototype.accumulateDeps = function (file, result) {
        var _this = this;
        result = result || [];
        if (result.indexOf(file) < 0) {
            result.push(file);
            file.deps.forEach(function (dep) { return _this.accumulateDeps(dep, result); });
        }
        return result;
    };
    TypeChecker.prototype.getAllDiagnostics = function (file) {
        var _this = this;
        var deps = this.accumulateDeps(file);
        var filelist = deps.map(function (dep) { return dep.sourceName; }).concat([compiler_host_1.__HTML_MODULE__]);
        var program = ts.createProgram(filelist, this._options, this._host);
        return deps.reduce(function (diags, dep) {
            if (!dep.isDefaultLib && !dep.checked) {
                var sourceFile = _this._host.getSourceFile(dep.sourceName);
                diags = diags
                    .concat(program.getSyntacticDiagnostics(sourceFile))
                    .concat(program.getSemanticDiagnostics(sourceFile));
                dep.checked = true;
            }
            return diags;
        }, program.getGlobalDiagnostics());
    };
    return TypeChecker;
})();
exports.TypeChecker = TypeChecker;
var Deferred = (function () {
    function Deferred() {
        var _this = this;
        this.promise = new Promise(function (resolve, reject) {
            _this.resolve = resolve;
            _this.reject = reject;
        });
    }
    return Deferred;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZS1jaGVja2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3R5cGUtY2hlY2tlci50cyJdLCJuYW1lcyI6WyJUeXBlQ2hlY2tlciIsIlR5cGVDaGVja2VyLmNvbnN0cnVjdG9yIiwiVHlwZUNoZWNrZXIuY2hlY2siLCJUeXBlQ2hlY2tlci5yZWdpc3RlckRlY2xhcmF0aW9uRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyU291cmNlIiwiVHlwZUNoZWNrZXIucmVzb2x2ZURlcGVuZGVuY2llcyIsIlR5cGVDaGVja2VyLmNhbkVtaXQiLCJUeXBlQ2hlY2tlci5hY2N1bXVsYXRlRGVwcyIsIlR5cGVDaGVja2VyLmdldEFsbERpYWdub3N0aWNzIiwiRGVmZXJyZWQiLCJEZWZlcnJlZC5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBWSxFQUFFLFdBQU0sWUFBWSxDQUFDLENBQUE7QUFDakMsdUJBQW1CLFVBQVUsQ0FBQyxDQUFBO0FBRzlCLHNCQUErRCxTQUFTLENBQUMsQ0FBQTtBQUN6RSw4QkFBOEIsaUJBQWlCLENBQUMsQ0FBQTtBQUVoRCxJQUFJLE1BQU0sR0FBRyxJQUFJLGdCQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztBQVkxQztJQVFDQSxxQkFBWUEsSUFBa0JBLEVBQUVBLE9BQXdCQSxFQUFFQSxLQUFvQkE7UUFDN0VDLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2xCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN4QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFFaEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBQ3REQSxJQUFJ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QTtZQUM1QkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBSUEsVUFBVUEsNkJBQTBCQSxDQUFDQSxDQUFDQTtRQUUxREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDaERBLENBQUNBO0lBTU9MLHlDQUFtQkEsR0FBM0JBLFVBQTRCQSxVQUFrQkEsRUFBRUEsTUFBY0E7UUFBOURNLGlCQThCQ0E7UUE3QkFBLElBQUlBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLGNBQWNBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBSTNDQSxJQUFJQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxlQUFlQTthQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBQ0EsR0FBR0E7WUFDUkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsaUJBQVNBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEtBQUlBLENBQUNBLFFBQVFBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZHQSxNQUFNQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQTtZQUM1QkEsSUFBSUE7Z0JBQ0hBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBO1FBQ3RCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUdKQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQTthQUM5QkEsR0FBR0EsQ0FBQ0EsVUFBQ0EsR0FBR0EsSUFBS0EsT0FBQUEsR0FBR0EsQ0FBQ0EsUUFBUUEsRUFBWkEsQ0FBWUEsQ0FBQ0EsQ0FBQ0E7UUFFN0JBLElBQUlBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLFVB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Q0FBQ0EsQ0FBQ0E7SUFDSkEsQ0FBQ0E7SUFDRkQsZUFBQ0E7QUFBREEsQ0FBQ0EsQUFYRCxJQVdDIiwic291cmNlc0NvbnRlbnQiOlsiLyogKi9cbmltcG9ydCAqIGFzIHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQge0NvbXBpbGVySG9zdCwgQ29tYmluZWRPcHRpb25zfSBmcm9tICcuL2NvbXBpbGVyLWhvc3QnO1xuaW1wb3J0IHtmb3JtYXRFcnJvcnN9IGZyb20gJy4vZm9ybWF0LWVycm9ycyc7XG5pbXBvcnQge2lzVHlwZXNjcmlwdCwgaXNUeXBlc2NyaXB0RGVjbGFyYXRpb24sIGlzQW1iaWVudH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7X19IVE1MX01PRFVMRV9ffSBmcm9tIFwiLi9jb21waWxlci1ob3N0XCI7XG5cbmxldCBsb2dnZXIgPSBuZXcgTG9nZ2VyKHsgZGVidWc6IGZhbHNlIH0pO1xuXG5pbnRlcmZhY2UgRmlsZUVudHJ5IHtcblx0c291cmNlTmFtZTogc3RyaW5nO1xuXHRzb3VyY2U6IERlZmVycmVkPHN0cmluZz47XG5cdGRlcHM/OiBGaWxlRW50cnlbXTtcblx0bG9hZGVkOiBQcm9taXNlPGFueT47XG5cdGVycm9yczogUHJvbWlzZTx0cy5EaWFnbm9zdGljW10+O1xuXHRpc0RlZmF1bHRMaWI6IGJvb2xlYW47XG5cdGNoZWNrZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBUeXBlQ2hlY2tlciB7XG5cdHByaXZhdGUgX2hvc3Q6IENvbXBpbGVySG9zdDtcblx0cHJpdmF0ZSBfcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uO1xuXHRwcml2YXRlIF9mZXRjaDogRmV0Y2hGdW5jdGlvbjtcbiAgIHByaXZhdGUgX29wdGlvbnM6IENvbWJpbmVkT3B0aW9ucztcblx0cHJpdmF0ZSBfZmlsZXM6IE1hcDxzdHJpbmcsIEZpbGVFbnRyeT47XG5cdHByaXZhdGUgX2RlY2xhcmF0aW9uRmlsZXM6IEZpbGVFbnRyeVtdO1xuXG5cdGNvbnN0cnVjdG9yKGhvc3Q6IENvbXBpbGVySG9zdCwgcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uLCBmZXRjaDogRmV0Y2hGdW5jdGlvbikge1xuXHRcdHRoaXMuX2hvc3QgPSBob3N0O1xuXHRcdHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xuXHRcdHRoaXMuX2ZldGNoID0gZmV0Y2g7XG5cbiAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuX2hvc3Qub3B0aW9ucyk7XG5cdFx0dGhpcy5fb3B0aW9ucy5pbmxpbmVTb3VyY2VNYXAgPSBmYWxzZTtcblx0XHR0aGlzLl9vcHRpb25zLnNvdXJjZU1hcCA9IGZhbHNlO1xuXHRcdHRoaXMuX29wdGlvbnMuZGVjbGFyYXRpb24gPSBmYWxzZTtcblx0XHR0aGlzLl9vcHRpb25zLmlzb2xhdGVkTW9kdWxlcyA9IGZhbHNlO1xuXG5cdFx0Ly8gbWFwIG9mIGFsbCB0eXBlc2NyaXB0IGZpbGVzIC0+IGZpbGUtZW50cnlcblx0XHR0aGlzLl9maWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBGaWxlRW50cnk+KCk7XG5cblx0XHQvLyBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIGRlY2xhcmF0aW9uIGZpbGVzXG5cdFx0dGhpcy5fZGVjbGFyYXRpb25GaWxlcyA9IFtdO1xuXHR9XG5cblx0Lypcblx0XHRyZXR1cm5zIGEgcHJvbWlzZSB0byBhbiBhcnJheSBvZiB0eXBlc2NyaXB0IGVycm9ycyBmb3IgdGhpcyBmaWxlXG5cdCovXG5cdHB1YmxpYyBjaGVjayhzb3VyY2VOYW1lOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKSB7XG5cdFx0dmFyIGZpbGUgPSB0aGlzLnJlZ2lzdGVyRmlsZShzb3VyY2VOYW1lKTtcblx0XHR0aGlzLnJlZ2lzdGVyU291cmNlKHNvdXJjZU5hbWUsIHNvdXJjZSk7XG5cdFx0cmV0dXJuIGZpbGUuZXJyb3JzO1xuXHR9XG5cblx0Lypcblx0XHRyZWdpc3RlciBkZWNsYXJhdGlvbiBmaWxlcyBmcm9tIGNvbmZpZ1xuXHQqL1xuXHRwdWJsaWMgcmVnaXN0ZXJEZWNsYXJhdGlvbkZpbGUoc291cmNlTmFtZTogc3RyaW5nLCBpc0RlZmF1bHRMaWI6IGJvb2xlYW4pIHtcblx0XHRsZXQgZmlsZSA9IHRoaXMucmVnaXN0ZXJGaWxlKHNvdXJjZU5hbWUsIGlzRGVmYXVsdExpYik7XG5cdFx0dGhpcy5fZGVjbGFyYXRpb25GaWxlcy5wdXNoKGZpbGUpO1xuXHRcdHJldHVybiBmaWxlO1xuXHR9XG5cblx0LyogcHJpdmF0ZSAqL1xuXG5cdHByaXZhdGUgcmVnaXN0ZXJGaWxlKHNvdXJjZU5hbWU6IHN0cmluZywgaXNEZWZhdWx0TGliOiBib29sZWFuID0gZmFsc2UpIHtcblx0XHRpZiAoIXRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdKSB7XG5cdFx0XHRsZXQgc291cmNlID0gbmV3IERlZmVycmVkPHN0cmluZz4oKVxuXG5cdFx0XHQvKiB3ZSBuZWVkIHRvIGZldGNoIGRlY2xhcmF0aW9uIGZpbGVzIG91cnNlbHZlcyAqL1xuXHRcdFx0aWYgKGlzVHlwZXNjcmlwdERlY2xhcmF0aW9uKHNvdXJjZU5hbWUpKSB7XG5cdFx0XHRcdHRoaXMuX2ZldGNoKHNvdXJjZU5hbWUpXG5cdFx0XHRcdFx0LnRoZW4oKHNvdXJjZSkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5faG9zdC5hZGRGaWxlKHNvdXJjZU5hbWUsIHNvdXJjZSk7XG5cdFx0XHRcdFx0XHR0aGlzLnJlZ2lzdGVyU291cmNlKHNvdXJjZU5hbWUsIHNvdXJjZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8qIGxvYWRlZCBpcyBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiB0aGUgc291cmNlIGhhcyBiZWVuIGFkZGVkIHRvIHRoZVxuXHRcdFx0XHRob3N0IGFuZCBhbGwgdGhlIGRlcGVuZGVuY2llcyB1c2VkIGJ5IHRoaXMgZmlsZSBoYXZlIGJlZW4gcmVzb2x2ZWQgKi9cblx0XHRcdGxldCBsb2FkZWQgPSBzb3VyY2UucHJvbWlzZVxuXHRcdFx0XHQudGhlbigoc291cmNlKSA9PiB0aGlzLnJlc29sdmVEZXBlbmRlbmNpZXMoc291cmNlTmFtZSwgc291cmNlKSlcblx0XHRcdFx0LnRoZW4oKGRlcHNNYXApID0+IHtcblx0XHRcdFx0XHR0aGlzLl9ob3N0LmFkZFJlc29sdXRpb25NYXAoc291cmNlTmFtZSwgZGVwc01hcCk7XG5cblx0XHRcdFx0XHR0aGlzLl9maWxlc1tzb3VyY2VOYW1lXS5kZXBzID0gT2JqZWN0LmtleXMoZGVwc01hcClcblx0XHRcdFx0XHRcdC5tYXAoKGtleSkgPT4gZGVwc01hcFtrZXldKVxuXHRcdFx0XHRcdFx0LmZpbHRlcigocmVzKSA9PiBpc1R5cGVzY3JpcHQocmVzKSkgLy8gaWdub3JlIGUuZy4gY3NzIGZpbGVzXG5cdFx0XHRcdFx0XHQubWFwKChyZXMpID0+IHRoaXMucmVnaXN0ZXJGaWxlKHJlcykpXG5cdFx0XHRcdFx0XHQuY29uY2F0KHRoaXMuX2RlY2xhcmF0aW9uRmlsZXMpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0LyogZXJyb3JzIGlzIGEgcHJvbWlzZSB0byB0aGUgY29tcGlsYXRpb24gcmVzdWx0cyAqL1xuXHRcdFx0bGV0IGVycm9ycyA9IGxvYWRlZFxuXHRcdFx0XHQudGhlbigoKSA9PiB0aGlzLmNhbkVtaXQodGhpcy5fZmlsZXNbc291cmNlTmFtZV0pKVxuXHRcdFx0XHQudGhlbigoKSA9PiB0aGlzLmdldEFsbERpYWdub3N0aWNzKHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdKSk7XG5cblx0XHRcdHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdID0ge1xuXHRcdFx0XHRzb3VyY2VOYW1lLFxuXHRcdFx0XHRzb3VyY2UsXG5cdFx0XHRcdGlzRGVmYXVsdExpYixcblx0XHRcdFx0bG9hZGVkLFxuXHRcdFx0XHRlcnJvcnMsXG5cdFx0XHRcdGNoZWNrZWQ6IGZhbHNlLFxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fZmlsZXNbc291cmNlTmFtZV07XG5cdH1cblxuXHRwcml2YXRlIHJlZ2lzdGVyU291cmNlKHNvdXJjZU5hbWU6IHN0cmluZywgc291cmNlOiBzdHJpbmcpIHtcblx0XHRpZiAoIXRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGAke3NvdXJjZU5hbWV9IGhhcyBub3QgYmVlbiByZWdpc3RlcmVkYCk7XG5cblx0XHR0aGlzLl9maWxlc1tzb3VyY2VOYW1lXS5zb3VyY2UucmVzb2x2ZShzb3VyY2UpO1xuXHR9XG5cblx0Lypcblx0XHRwcm9jZXNzIHRoZSBzb3VyY2UgdG8gZ2V0IGl0cyBkZXBlbmRlbmNpZXMgYW5kIHJlc29sdmUgYW5kIHJlZ2lzdGVyIHRoZW1cblx0XHRyZXR1cm5zIGEgcHJvbWlzZSB0byB0aGUgbGlzdCBvZiByZWdpc3RlcmVkIGRlcGVuZGVuY3kgZmlsZXNcblx0Ki9cblx0cHJpdmF0ZSByZXNvbHZlRGVwZW5kZW5jaWVzKHNvdXJjZU5hbWU6IHN0cmluZywgc291cmNlOiBzdHJpbmcpIHtcblx0XHRsZXQgaW5mbyA9IHRzLnByZVByb2Nlc3NGaWxlKHNvdXJjZSwgdHJ1ZSk7XG5cblx0XHQvKiBidWlsZCB0aGUgbGlzdCBvZiBmaWxlcyB3ZSBuZWVkIHRvIHJlc29sdmUgKi9cblx0XHQvKiByZWZlcmVuY2VzIGZpcnN0ICovXG5cdFx0bGV0IHJlZmVyZW5jZXMgPSBpbmZvLnJlZmVyZW5jZWRGaWxlc1xuXHRcdFx0Lm1hcCgocmVmKSA9PiB7XG5cdFx0XHRcdGlmICgoaXNBbWJpZW50KHJlZi5maWxlTmFtZSkgJiYgIXRoaXMuX29wdGlvbnMucmVzb2x2ZUFtYmllbnRSZWZzKSB8fCAocmVmLmZpbGVOYW1lLmluZGV4T2YoXCIvXCIpID09IC0xKSlcblx0XHRcdFx0XHRyZXR1cm4gXCIuL1wiICsgcmVmLmZpbGVOYW1lO1xuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0cmV0dXJuIHJlZi5maWxlTmFtZTtcblx0XHRcdH0pO1xuXG5cdFx0Lyogbm93IGltcG9ydHMgKi9cblx0XHRsZXQgaW1wb3J0cyA9IGluZm8uaW1wb3J0ZWRGaWxlc1xuXHRcdFx0Lm1hcCgoaW1wKSA9PiBpbXAuZmlsZU5hbWUpO1xuXG5cdFx0bGV0IHJlZnMgPSBbXS5jb25jYXQocmVmZXJlbmNlcykuY29uY2F0KGltcG9ydHMpO1xuXG5cdFx0LyogY29udmVydCB0byBsaXN0IG9mIHByb21pc2VzIHRvIHJlc29sdmVkIGFkZHJlc3NlcyAqL1xuXHRcdGxldCBkZXBzID0gcmVmcy5tYXAoKHJlZikgPT4gdGhpcy5fcmVzb2x2ZShyZWYsIHNvdXJjZU5hbWUpKTtcblxuXHRcdC8qIGFuZCBjb252ZXJ0IHRvIHByb21pc2UgdG8gYSBtYXAgb2YgbG9jYWwgcmVmZXJlbmNlIHRvIHJlc29sdmVkIGRlcGVuZGVuY3kgKi9cblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwoZGVwcylcblx0XHRcdC50aGVuKChyZXNvbHZlZCkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gcmVmcy5yZWR1Y2UoKHJlc3VsdCwgcmVmLCBpZHgpID0+IHtcblx0XHRcdFx0XHRyZXN1bHRbcmVmXSA9IHJlc29sdmVkW2lkeF07XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fSwge30pO1xuXHRcdFx0fSk7XG5cdH1cblxuXHQvKlxuXHRcdHJldHVybnMgcHJvbWlzZSByZXNvbHZlZCB3aGVuIGZpbGUgY2FuIGJlIGVtaXR0ZWRcblx0Ki9cblx0cHJpdmF0ZSBjYW5FbWl0KGZpbGU6IEZpbGVFbnRyeSwgc2Vlbj86IEZpbGVFbnRyeVtdKSB7XG5cdFx0LyogYXZvaWQgY2lyY3VsYXIgcmVmZXJlbmNlcyAqL1xuXHRcdHNlZW4gPSBzZWVuIHx8IFtdO1xuXG5cdFx0aWYgKHNlZW4uaW5kZXhPZihmaWxlKSA8IDApIHtcblx0XHRcdHNlZW4ucHVzaChmaWxlKTtcblxuXHRcdFx0cmV0dXJuIGZpbGUubG9hZGVkLnRoZW4oKCkgPT4gUHJvbWlzZS5hbGwoZmlsZS5kZXBzLm1hcCgoZGVwKSA9PiB0aGlzLmNhbkVtaXQoZGVwLCBzZWVuKSkpKTtcblx0XHR9XG5cdH1cblxuXHQvKlxuXHRcdFJldHVybnMgYSBmbGF0dGVuZWQgbGlzdCBvZiB0aGUgZGVwZW5kZW5jeSB0cmVlIGZvciB0aGlzIGZpbGUuXG5cdCovXG5cdHByaXZhdGUgYWNjdW11bGF0ZURlcHMoZmlsZTogRmlsZUVudHJ5LCByZXN1bHQ/OiBGaWxlRW50cnlbXSk6IEZpbGVFbnRyeVtdIHtcblx0XHRyZXN1bHQgPSByZXN1bHQgfHwgW107XG5cblx0XHRpZiAocmVzdWx0LmluZGV4T2YoZmlsZSkgPCAwKSB7XG5cdFx0XHRyZXN1bHQucHVzaChmaWxlKTtcblx0XHRcdGZpbGUuZGVwcy5mb3JFYWNoKChkZXApID0+IHRoaXMuYWNjdW11bGF0ZURlcHMoZGVwLCByZXN1bHQpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG5cblx0Lypcblx0XHRSZXR1cm5zIHRoZSBkaWFnbm9zdGljcyBmb3IgdGhpcyBmaWxlIGFuZCBhbnkgZmlsZXMgd2hpY2ggaXQgdXNlcy5cblx0XHRFYWNoIGZpbGUgaXMgb25seSBjaGVja2VkIG9uY2UuXG5cdCovXG5cdHByaXZhdGUgZ2V0QWxsRGlhZ25vc3RpY3MoZmlsZTogRmlsZUVudHJ5KTogdHMuRGlhZ25vc3RpY1tdIHtcblx0XHRsZXQgZGVwcyA9IHRoaXMuYWNjdW11bGF0ZURlcHMoZmlsZSk7XG5cblx0XHQvLyBoYWNrIHRvIHN1cHBvcnQgaHRtbCBpbXBvcnRzXG5cdFx0bGV0IGZpbGVsaXN0ID0gZGVwcy5tYXAoKGRlcCkgPT4gZGVwLnNvdXJjZU5hbWUpLmNvbmNhdChbX19IVE1MX01PRFVMRV9fXSk7XG5cdFx0bGV0IHByb2dyYW0gPSB0cy5jcmVhdGVQcm9ncmFtKGZpbGVsaXN0LCB0aGlzLl9vcHRpb25zLCB0aGlzLl9ob3N0KTtcblxuXHRcdHJldHVybiBkZXBzLnJlZHVjZSgoZGlhZ3MsIGRlcCkgPT4ge1xuXHRcdFx0Ly8gZG9uJ3QgY2hlY2sgdGhlIGRlZmF1bHQgbGliIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2Vcblx0XHRcdGlmICghZGVwLmlzRGVmYXVsdExpYiAmJiAhZGVwLmNoZWNrZWQpIHtcblx0XHRcdFx0bGV0IHNvdXJjZUZpbGUgPSB0aGlzLl9ob3N0LmdldFNvdXJjZUZpbGUoZGVwLnNvdXJjZU5hbWUpO1xuXG5cdFx0XHRcdGRpYWdzID0gZGlhZ3Ncblx0XHRcdFx0XHQuY29uY2F0KHByb2dyYW0uZ2V0U3ludGFjdGljRGlhZ25vc3RpY3Moc291cmNlRmlsZSkpXG5cdFx0XHRcdFx0LmNvbmNhdChwcm9ncmFtLmdldFNlbWFudGljRGlhZ25vc3RpY3Moc291cmNlRmlsZSkpO1xuXG5cdFx0XHRcdGRlcC5jaGVja2VkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBkaWFncztcblx0XHR9LCBwcm9ncmFtLmdldEdsb2JhbERpYWdub3N0aWNzKCkpO1xuXHR9XG59XG5cbmNsYXNzIERlZmVycmVkPFQ+IHtcblx0cHVibGljIHJlc29sdmU6IChyZXN1bHQ6IFQpID0+IHZvaWQ7XG5cdHB1YmxpYyByZWplY3Q6IChlcnI6IEVycm9yKSA9PiB2b2lkO1xuXHRwdWJsaWMgcHJvbWlzZTogUHJvbWlzZTxUPjtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZTxUPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuXHRcdFx0dGhpcy5yZWplY3QgPSByZWplY3Q7XG5cdFx0fSk7XG5cdH1cbn1cbiJdfQ==