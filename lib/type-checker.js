var ts = require('typescript');
var logger_1 = require('./logger');
var utils_1 = require("./utils");
var compiler_host_1 = require("./compiler-host");
var logger = new logger_1.default({ debug: false });
var TypeChecker = (function () {
    function TypeChecker(host, resolve, fetch) {
        this._host = host;
        this._resolve = resolve;
        this._fetch = fetch;
        this._options = Object.assign({}, this._host.options);
        this._options.inlineSourceMap = false;
        this._options.sourceMap = false;
        this._options.declaration = false;
        this._options.isolatedModules = false;
        this._files = new Map();
        this._declarationFiles = [];
    }
    TypeChecker.prototype.check = function (sourceName, source) {
        var file = this.registerFile(sourceName);
        this.registerSource(sourceName, source);
        return file.errors;
    };
    TypeChecker.prototype.registerDeclarationFile = function (sourceName, isDefaultLib) {
        var file = this.registerFile(sourceName, isDefaultLib);
        this._declarationFiles.push(file);
        return file;
    };
    TypeChecker.prototype.registerFile = function (sourceName, isDefaultLib) {
        var _this = this;
        if (isDefaultLib === void 0) { isDefaultLib = false; }
        if (!this._files[sourceName]) {
            var source = new Deferred();
            if (utils_1.isTypescriptDeclaration(sourceName)) {
                this._fetch(sourceName)
                    .then(function (source) {
                    _this._host.addFile(sourceName, source);
                    _this.registerSource(sourceName, source);
                });
            }
            var loaded = source.promise
                .then(function (source) { return _this.resolveDependencies(sourceName, source); })
                .then(function (depsMap) {
                _this._host.addResolutionMap(sourceName, depsMap);
                _this._files[sourceName].deps = Object.keys(depsMap)
                    .map(function (key) { return depsMap[key]; })
                    .filter(function (res) { return utils_1.isTypescript(res); })
                    .map(function (res) { return _this.registerFile(res); })
                    .concat(_this._declarationFiles);
            });
            var errors = loaded
                .then(function () { return _this.canEmit(_this._files[sourceName]); })
                .then(function () { return _this.getAllDiagnostics(_this._files[sourceName]); });
            this._files[sourceName] = {
                sourceName: sourceName,
                source: source,
                isDefaultLib: isDefaultLib,
                loaded: loaded,
                errors: errors,
                checked: false,
            };
        }
        return this._files[sourceName];
    };
    TypeChecker.prototype.registerSource = function (sourceName, source) {
        if (!this._files[sourceName])
            throw new Error(sourceName + " has not been registered");
        this._files[sourceName].source.resolve(source);
    };
    TypeChecker.prototype.resolveDependencies = function (sourceName, source) {
        var _this = this;
        var info = ts.preProcessFile(source, true);
        var references = info.referencedFiles
            .map(function (ref) {
            if ((utils_1.isAmbient(ref.fileName) && !_this._options.resolveAmbientRefs) || (ref.fileName.indexOf("/") == -1))
                return "./" + ref.fileName;
            else
                return ref.fileName;
        });
        var imports = info.importedFiles
            .map(function (imp) { return imp.fileName; });
        var refs = [].concat(references).concat(imports);
        var deps = refs.map(function (ref) { return _this._resolve(ref, sourceName); });
        return Promise.all(deps)
            .then(function (resolved) {
            return refs.reduce(function (result, ref, idx) {
                result[ref] = resolved[idx];
                return result;
            }, {});
        });
    };
    TypeChecker.prototype.canEmit = function (file, seen) {
        var _this = this;
        seen = seen || [];
        if (seen.indexOf(file) < 0) {
            seen.push(file);
            return file.loaded.then(function () { return Promise.all(file.deps.map(function (dep) { return _this.canEmit(dep, seen); })); });
        }
    };
    TypeChecker.prototype.accumulateDeps = function (file, result) {
        var _this = this;
        result = result || [];
        if (result.indexOf(file) < 0) {
            result.push(file);
            file.deps.forEach(function (dep) { return _this.accumulateDeps(dep, result); });
        }
        return result;
    };
    TypeChecker.prototype.getAllDiagnostics = function (file) {
        var _this = this;
        var deps = this.accumulateDeps(file);
        var filelist = deps.map(function (dep) { return dep.sourceName; }).concat([compiler_host_1.__HTML_MODULE__]);
        var program = ts.createProgram(filelist, this._options, this._host);
        return deps.reduce(function (diags, dep) {
            if (!dep.isDefaultLib && !dep.checked) {
                var sourceFile = _this._host.getSourceFile(dep.sourceName);
                diags = diags
                    .concat(program.getSyntacticDiagnostics(sourceFile))
                    .concat(program.getSemanticDiagnostics(sourceFile));
                dep.checked = true;
            }
            return diags;
        }, program.getGlobalDiagnostics());
    };
    return TypeChecker;
})();
exports.TypeChecker = TypeChecker;
var Deferred = (function () {
    function Deferred() {
        var _this = this;
        this.promise = new Promise(function (resolve, reject) {
            _this.resolve = resolve;
            _this.reject = reject;
        });
    }
    return Deferred;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZS1jaGVja2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3R5cGUtY2hlY2tlci50cyJdLCJuYW1lcyI6WyJUeXBlQ2hlY2tlciIsIlR5cGVDaGVja2VyLmNvbnN0cnVjdG9yIiwiVHlwZUNoZWNrZXIuY2hlY2siLCJUeXBlQ2hlY2tlci5yZWdpc3RlckRlY2xhcmF0aW9uRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyU291cmNlIiwiVHlwZUNoZWNrZXIucmVzb2x2ZURlcGVuZGVuY2llcyIsIlR5cGVDaGVja2VyLmNhbkVtaXQiLCJUeXBlQ2hlY2tlci5hY2N1bXVsYXRlRGVwcyIsIlR5cGVDaGVja2VyLmdldEFsbERpYWdub3N0aWNzIiwiRGVmZXJyZWQiLCJEZWZlcnJlZC5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBWSxFQUFFLFdBQU0sWUFBWSxDQUFDLENBQUE7QUFDakMsdUJBQW1CLFVBQVUsQ0FBQyxDQUFBO0FBRzlCLHNCQUErRCxTQUFTLENBQUMsQ0FBQTtBQUN6RSw4QkFBOEIsaUJBQWlCLENBQUMsQ0FBQTtBQUVoRCxJQUFJLE1BQU0sR0FBRyxJQUFJLGdCQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztBQVkxQztJQVFDQSxxQkFBWUEsSUFBa0JBLEVBQUVBLE9BQXdCQSxFQUFFQSxLQUFvQkE7UUFDN0VDLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2xCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN4QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFFaEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLENBQUNB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QSxDQUFDQSxDQUFDQTtZQUM1QkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBSUEsVUFBVUEsNkJBQTBCQSxDQUFDQSxDQUFDQTtRQUUxREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDaERBLENBQUNBO0lBTU9MLHlDQUFtQkEsR0FBM0JBLFVBQTRCQSxVQUFrQkEsRUFBRUEsTUFBY0E7UUFBOURNLGlCQThCQ0E7UUE3QkFBLElBQUlBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLGNBQWNBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBSTNDQSxJQUFJQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxlQUFlQTthQUNuQ0EsR0FBR0EsQ0FBQ0EsVUFBQ0EsR0FBR0E7WUFDUkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsaUJBQVNBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEtBQUlBLENBQUNBLFFBQVFBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZHQSxNQUFNQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQTtZQUM1QkEsSUFBSUE7Z0JBQ0hBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBO1FBQ3RCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUdKQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQTthQUM5QkEsR0FBR0EsQ0FBQ0EsVUFBQ0EsR0FBR0EsSUFBS0EsT0FBQUEsR0FBR0EsQ0FBQ0EsUUFBUUEsRUFBWkEsQ0FBWUEsQ0FBQ0EsQ0FBQ0E7UUFFN0JBLElBQUlBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1FBR2pEQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFDQSxHQUFHQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxFQUFFQSxVQUFVQSxDQUFDQSxFQUE5QkEsQ0FBOEJBLENBQUNBLENBQUNBO1FBRzdEQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQTthQUN0QkEsSUFBSUEsQ0FBQ0EsVUFBQ0EsUUFBUUE7WUFDZEEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBQ0EsTUFBTUEsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0E7Z0JBQ25DQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDNUJBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1lBQ2ZBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1FBQ1JBLENBQUNBLENBQUNBLENBQUNBO0lBQ0xBLENBQUNBO0lBS09OLDZCQUFPQSxHQUFmQSxVQUFnQkEsSUFBZUEsRUFBRUEsSUFBa0JBO1FBQW5ETyxpQkFTQ0E7UUFQQUEsSUFBSUEsR0FBR0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFFbEJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUVoQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBTUEsT0FBQUEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBQ0EsR0FBR0EsSUFBS0EsT0FBQUEsS0FBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsRUFBRUEsSUFBSUEsQ0FBQ0EsRUFBdkJBLENBQXVCQSxDQUFDQSxDQUFDQSxFQUE1REEsQ0FBNERBLENBQUNBLENBQUNBO1FBQzdGQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUtPUCxvQ0FBY0EsR0FBdEJBLFVBQXVCQSxJQUFlQSxFQUFFQSxNQUFvQkE7UUFBNURRLGlCQVNDQTtRQVJBQSxNQUFNQSxHQUFHQSxNQUFNQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUV0QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUJBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ2xCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFDQSxHQUFHQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxHQUFHQSxFQUFFQSxNQUFNQSxDQUFDQSxFQUFoQ0EsQ0FBZ0NBLENBQUNBLENBQUNBO1FBQzlEQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNmQSxDQUFDQTtJQU1PUix1Q0FBaUJBLEdBQXpCQSxVQUEwQkEsSUFBZUE7UUFBekNTLGlCQW9CQ0E7UUFuQkFBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBR3JDQSxJQUFJQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFDQSxHQUFHQSxJQUFLQSxPQUFBQSxHQUFHQSxDQUFDQSxVQUFVQSxFQUFkQSxDQUFjQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSwrQkFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0VBLElBQUlBLE9BQU9BLEdBQUdBLEVBQUVBLENBQUNBLGFBQWFBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBRXBFQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFDQSxLQUFLQSxFQUFFQSxHQUFHQTtZQUU3QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsWUFBWUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZDQSxJQUFJQSxVQUFVQSxHQUFHQSxLQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtnQkFFMURBLEtBQUtBLEdBQUdBLEtBQUtBO3FCQUNYQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSx1QkFBdUJBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO3FCQUNuREEsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0Esc0JBQXNCQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFFckRBLEdBQUdBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1lBQ3BCQSxDQUFDQTtZQUNEQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUNkQSxDQUFDQSxFQUFFQSxPQUFPQSxDQUFDQSxvQkFBb0JBLEVBQUVBLENBQUNBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUNGVCxrQkFBQ0E7QUFBREEsQ0FBQ0EsQUEzTEQsSUEyTEM7QUEzTFksbUJBQVcsY0EyTHZCLENBQUE7QUFFRDtJQUtDVTtRQUxEQyxpQkFXQ0E7UUFMQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsT0FBT0EsQ0FBSUEsVUFBQ0EsT0FBT0EsRUFBRUEsTUFBTUE7WUFDN0NBLEtBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO1lBQ3ZCQSxLQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUN0QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDSkEsQ0FBQ0E7SUFDRkQsZUFBQ0E7QUFBREEsQ0FBQ0EsQUFYRCxJQVdDIiwic291cmNlc0NvbnRlbnQiOlsiLyogKi9cbmltcG9ydCAqIGFzIHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQge0NvbXBpbGVySG9zdCwgQ29tYmluZWRPcHRpb25zfSBmcm9tICcuL2NvbXBpbGVyLWhvc3QnO1xuaW1wb3J0IHtmb3JtYXRFcnJvcnN9IGZyb20gJy4vZm9ybWF0LWVycm9ycyc7XG5pbXBvcnQge2lzVHlwZXNjcmlwdCwgaXNUeXBlc2NyaXB0RGVjbGFyYXRpb24sIGlzQW1iaWVudH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7X19IVE1MX01PRFVMRV9ffSBmcm9tIFwiLi9jb21waWxlci1ob3N0XCI7XG5cbmxldCBsb2dnZXIgPSBuZXcgTG9nZ2VyKHsgZGVidWc6IGZhbHNlIH0pO1xuXG5pbnRlcmZhY2UgRmlsZUVudHJ5IHtcblx0c291cmNlTmFtZTogc3RyaW5nO1xuXHRzb3VyY2U6IERlZmVycmVkPHN0cmluZz47XG5cdGRlcHM/OiBGaWxlRW50cnlbXTtcblx0bG9hZGVkOiBQcm9taXNlPGFueT47XG5cdGVycm9yczogUHJvbWlzZTx0cy5EaWFnbm9zdGljW10+O1xuXHRpc0RlZmF1bHRMaWI6IGJvb2xlYW47XG5cdGNoZWNrZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBUeXBlQ2hlY2tlciB7XG5cdHByaXZhdGUgX2hvc3Q6IENvbXBpbGVySG9zdDtcblx0cHJpdmF0ZSBfcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uO1xuXHRwcml2YXRlIF9mZXRjaDogRmV0Y2hGdW5jdGlvbjtcbiAgIHByaXZhdGUgX29wdGlvbnM6IENvbWJpbmVkT3B0aW9ucztcblx0cHJpdmF0ZSBfZmlsZXM6IE1hcDxzdHJpbmcsIEZpbGVFbnRyeT47XG5cdHByaXZhdGUgX2RlY2xhcmF0aW9uRmlsZXM6IEZpbGVFbnRyeVtdO1xuXG5cdGNvbnN0cnVjdG9yKGhvc3Q6IENvbXBpbGVySG9zdCwgcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uLCBmZXRjaDogRmV0Y2hGdW5jdGlvbikge1xuXHRcdHRoaXMuX2hvc3QgPSBob3N0O1xuXHRcdHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xuXHRcdHRoaXMuX2ZldGNoID0gZmV0Y2g7XG5cbiAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9ob3N0Lm9wdGlvbnMpO1xuXHRcdHRoaXMuX29wdGlvbnMuaW5saW5lU291cmNlTWFwID0gZmFsc2U7XG5cdFx0dGhpcy5fb3B0aW9ucy5zb3VyY2VNYXAgPSBmYWxzZTtcblx0XHR0aGlzLl9vcHRpb25zLmRlY2xhcmF0aW9uID0gZmFsc2U7XG5cdFx0dGhpcy5fb3B0aW9ucy5pc29sYXRlZE1vZHVsZXMgPSBmYWxzZTtcblxuXHRcdC8vIG1hcCBvZiBhbGwgdHlwZXNjcmlwdCBmaWxlcyAtPiBmaWxlLWVudHJ5XG5cdFx0dGhpcy5fZmlsZXMgPSBuZXcgTWFwPHN0cmluZywgRmlsZUVudHJ5PigpO1xuXG5cdFx0Ly8gbGlzdCBvZiBhbGwgcmVnaXN0ZXJlZCBkZWNsYXJhdGlvbiBmaWxlc1xuXHRcdHRoaXMuX2RlY2xhcmF0aW9uRmlsZXMgPSBbXTtcblx0fVxuXG5cdC8qXG5cdFx0cmV0dXJucyBhIHByb21pc2UgdG8gYW4gYXJyYXkgb2YgdHlwZXNjcmlwdCBlcnJvcnMgZm9yIHRoaXMgZmlsZVxuXHQqL1xuXHRwdWJsaWMgY2hlY2soc291cmNlTmFtZTogc3RyaW5nLCBzb3VyY2U6IHN0cmluZykge1xuXHRcdHZhciBmaWxlID0gdGhpcy5yZWdpc3RlckZpbGUoc291cmNlTmFtZSk7XG5cdFx0dGhpcy5yZWdpc3RlclNvdXJjZShzb3VyY2VOYW1lLCBzb3VyY2UpO1xuXHRcdHJldHVybiBmaWxlLmVycm9ycztcblx0fVxuXG5cdC8qXG5cdFx0cmVnaXN0ZXIgZGVjbGFyYXRpb24gZmlsZXMgZnJvbSBjb25maWdcblx0Ki9cblx0cHVibGljIHJlZ2lzdGVyRGVjbGFyYXRpb25GaWxlKHNvdXJjZU5hbWU6IHN0cmluZywgaXNEZWZhdWx0TGliOiBib29sZWFuKSB7XG5cdFx0bGV0IGZpbGUgPSB0aGlzLnJlZ2lzdGVyRmlsZShzb3VyY2VOYW1lLCBpc0RlZmF1bHRMaWIpO1xuXHRcdHRoaXMuX2RlY2xhcmF0aW9uRmlsZXMucHVzaChmaWxlKTtcblx0XHRyZXR1cm4gZmlsZTtcblx0fVxuXG5cdC8qIHByaXZhdGUgKi9cblxuXHRwcml2YXRlIHJlZ2lzdGVyRmlsZShzb3VyY2VOYW1lOiBzdHJpbmcsIGlzRGVmYXVsdExpYjogYm9vbGVhbiA9IGZhbHNlKSB7XG5cdFx0aWYgKCF0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSkge1xuXHRcdFx0bGV0IHNvdXJjZSA9IG5ldyBEZWZlcnJlZDxzdHJpbmc+KClcblxuXHRcdFx0Lyogd2UgbmVlZCB0byBmZXRjaCBkZWNsYXJhdGlvbiBmaWxlcyBvdXJzZWx2ZXMgKi9cblx0XHRcdGlmIChpc1R5cGVzY3JpcHREZWNsYXJhdGlvbihzb3VyY2VOYW1lKSkge1xuXHRcdFx0XHR0aGlzLl9mZXRjaChzb3VyY2VOYW1lKVxuXHRcdFx0XHRcdC50aGVuKChzb3VyY2UpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuX2hvc3QuYWRkRmlsZShzb3VyY2VOYW1lLCBzb3VyY2UpO1xuXHRcdFx0XHRcdFx0dGhpcy5yZWdpc3RlclNvdXJjZShzb3VyY2VOYW1lLCBzb3VyY2UpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiBsb2FkZWQgaXMgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gdGhlIHNvdXJjZSBoYXMgYmVlbiBhZGRlZCB0byB0aGVcblx0XHRcdFx0aG9zdCBhbmQgYWxsIHRoZSBkZXBlbmRlbmNpZXMgdXNlZCBieSB0aGlzIGZpbGUgaGF2ZSBiZWVuIHJlc29sdmVkICovXG5cdFx0XHRsZXQgbG9hZGVkID0gc291cmNlLnByb21pc2Vcblx0XHRcdFx0LnRoZW4oKHNvdXJjZSkgPT4gdGhpcy5yZXNvbHZlRGVwZW5kZW5jaWVzKHNvdXJjZU5hbWUsIHNvdXJjZSkpXG5cdFx0XHRcdC50aGVuKChkZXBzTWFwKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5faG9zdC5hZGRSZXNvbHV0aW9uTWFwKHNvdXJjZU5hbWUsIGRlcHNNYXApO1xuXG5cdFx0XHRcdFx0dGhpcy5fZmlsZXNbc291cmNlTmFtZV0uZGVwcyA9IE9iamVjdC5rZXlzKGRlcHNNYXApXG5cdFx0XHRcdFx0XHQubWFwKChrZXkpID0+IGRlcHNNYXBba2V5XSlcblx0XHRcdFx0XHRcdC5maWx0ZXIoKHJlcykgPT4gaXNUeXBlc2NyaXB0KHJlcykpIC8vIGlnbm9yZSBlLmcuIGNzcyBmaWxlc1xuXHRcdFx0XHRcdFx0Lm1hcCgocmVzKSA9PiB0aGlzLnJlZ2lzdGVyRmlsZShyZXMpKVxuXHRcdFx0XHRcdFx0LmNvbmNhdCh0aGlzLl9kZWNsYXJhdGlvbkZpbGVzKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdC8qIGVycm9ycyBpcyBhIHByb21pc2UgdG8gdGhlIGNvbXBpbGF0aW9uIHJlc3VsdHMgKi9cblx0XHRcdGxldCBlcnJvcnMgPSBsb2FkZWRcblx0XHRcdFx0LnRoZW4oKCkgPT4gdGhpcy5jYW5FbWl0KHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdKSlcblx0XHRcdFx0LnRoZW4oKCkgPT4gdGhpcy5nZXRBbGxEaWFnbm9zdGljcyh0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSkpO1xuXG5cdFx0XHR0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSA9IHtcblx0XHRcdFx0c291cmNlTmFtZSxcblx0XHRcdFx0c291cmNlLFxuXHRcdFx0XHRpc0RlZmF1bHRMaWIsXG5cdFx0XHRcdGxvYWRlZCxcblx0XHRcdFx0ZXJyb3JzLFxuXHRcdFx0XHRjaGVja2VkOiBmYWxzZSxcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdO1xuXHR9XG5cblx0cHJpdmF0ZSByZWdpc3RlclNvdXJjZShzb3VyY2VOYW1lOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKSB7XG5cdFx0aWYgKCF0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSlcblx0XHRcdHRocm93IG5ldyBFcnJvcihgJHtzb3VyY2VOYW1lfSBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZGApO1xuXG5cdFx0dGhpcy5fZmlsZXNbc291cmNlTmFtZV0uc291cmNlLnJlc29sdmUoc291cmNlKTtcblx0fVxuXG5cdC8qXG5cdFx0cHJvY2VzcyB0aGUgc291cmNlIHRvIGdldCBpdHMgZGVwZW5kZW5jaWVzIGFuZCByZXNvbHZlIGFuZCByZWdpc3RlciB0aGVtXG5cdFx0cmV0dXJucyBhIHByb21pc2UgdG8gdGhlIGxpc3Qgb2YgcmVnaXN0ZXJlZCBkZXBlbmRlbmN5IGZpbGVzXG5cdCovXG5cdHByaXZhdGUgcmVzb2x2ZURlcGVuZGVuY2llcyhzb3VyY2VOYW1lOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKSB7XG5cdFx0bGV0IGluZm8gPSB0cy5wcmVQcm9jZXNzRmlsZShzb3VyY2UsIHRydWUpO1xuXG5cdFx0LyogYnVpbGQgdGhlIGxpc3Qgb2YgZmlsZXMgd2UgbmVlZCB0byByZXNvbHZlICovXG5cdFx0LyogcmVmZXJlbmNlcyBmaXJzdCAqL1xuXHRcdGxldCByZWZlcmVuY2VzID0gaW5mby5yZWZlcmVuY2VkRmlsZXNcblx0XHRcdC5tYXAoKHJlZikgPT4ge1xuXHRcdFx0XHRpZiAoKGlzQW1iaWVudChyZWYuZmlsZU5hbWUpICYmICF0aGlzLl9vcHRpb25zLnJlc29sdmVBbWJpZW50UmVmcykgfHwgKHJlZi5maWxlTmFtZS5pbmRleE9mKFwiL1wiKSA9PSAtMSkpXG5cdFx0XHRcdFx0cmV0dXJuIFwiLi9cIiArIHJlZi5maWxlTmFtZTtcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHJldHVybiByZWYuZmlsZU5hbWU7XG5cdFx0XHR9KTtcblxuXHRcdC8qIG5vdyBpbXBvcnRzICovXG5cdFx0bGV0IGltcG9ydHMgPSBpbmZvLmltcG9ydGVkRmlsZXNcblx0XHRcdC5tYXAoKGltcCkgPT4gaW1wLmZpbGVOYW1lKTtcblxuXHRcdGxldCByZWZzID0gW10uY29uY2F0KHJlZmVyZW5jZXMpLmNvbmNhdChpbXBvcnRzKTtcblxuXHRcdC8qIGNvbnZlcnQgdG8gbGlzdCBvZiBwcm9taXNlcyB0byByZXNvbHZlZCBhZGRyZXNzZXMgKi9cblx0XHRsZXQgZGVwcyA9IHJlZnMubWFwKChyZWYpID0+IHRoaXMuX3Jlc29sdmUocmVmLCBzb3VyY2VOYW1lKSk7XG5cblx0XHQvKiBhbmQgY29udmVydCB0byBwcm9taXNlIHRvIGEgbWFwIG9mIGxvY2FsIHJlZmVyZW5jZSB0byByZXNvbHZlZCBkZXBlbmRlbmN5ICovXG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKGRlcHMpXG5cdFx0XHQudGhlbigocmVzb2x2ZWQpID0+IHtcblx0XHRcdFx0cmV0dXJuIHJlZnMucmVkdWNlKChyZXN1bHQsIHJlZiwgaWR4KSA9PiB7XG5cdFx0XHRcdFx0cmVzdWx0W3JlZl0gPSByZXNvbHZlZFtpZHhdO1xuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdH0sIHt9KTtcblx0XHRcdH0pO1xuXHR9XG5cblx0Lypcblx0XHRyZXR1cm5zIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBmaWxlIGNhbiBiZSBlbWl0dGVkXG5cdCovXG5cdHByaXZhdGUgY2FuRW1pdChmaWxlOiBGaWxlRW50cnksIHNlZW4/OiBGaWxlRW50cnlbXSkge1xuXHRcdC8qIGF2b2lkIGNpcmN1bGFyIHJlZmVyZW5jZXMgKi9cblx0XHRzZWVuID0gc2VlbiB8fCBbXTtcblxuXHRcdGlmIChzZWVuLmluZGV4T2YoZmlsZSkgPCAwKSB7XG5cdFx0XHRzZWVuLnB1c2goZmlsZSk7XG5cblx0XHRcdHJldHVybiBmaWxlLmxvYWRlZC50aGVuKCgpID0+IFByb21pc2UuYWxsKGZpbGUuZGVwcy5tYXAoKGRlcCkgPT4gdGhpcy5jYW5FbWl0KGRlcCwgc2VlbikpKSk7XG5cdFx0fVxuXHR9XG5cblx0Lypcblx0XHRSZXR1cm5zIGEgZmxhdHRlbmVkIGxpc3Qgb2YgdGhlIGRlcGVuZGVuY3kgdHJlZSBmb3IgdGhpcyBmaWxlLlxuXHQqL1xuXHRwcml2YXRlIGFjY3VtdWxhdGVEZXBzKGZpbGU6IEZpbGVFbnRyeSwgcmVzdWx0PzogRmlsZUVudHJ5W10pOiBGaWxlRW50cnlbXSB7XG5cdFx0cmVzdWx0ID0gcmVzdWx0IHx8IFtdO1xuXG5cdFx0aWYgKHJlc3VsdC5pbmRleE9mKGZpbGUpIDwgMCkge1xuXHRcdFx0cmVzdWx0LnB1c2goZmlsZSk7XG5cdFx0XHRmaWxlLmRlcHMuZm9yRWFjaCgoZGVwKSA9PiB0aGlzLmFjY3VtdWxhdGVEZXBzKGRlcCwgcmVzdWx0KSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdC8qXG5cdFx0UmV0dXJucyB0aGUgZGlhZ25vc3RpY3MgZm9yIHRoaXMgZmlsZSBhbmQgYW55IGZpbGVzIHdoaWNoIGl0IHVzZXMuXG5cdFx0RWFjaCBmaWxlIGlzIG9ubHkgY2hlY2tlZCBvbmNlLlxuXHQqL1xuXHRwcml2YXRlIGdldEFsbERpYWdub3N0aWNzKGZpbGU6IEZpbGVFbnRyeSk6IHRzLkRpYWdub3N0aWNbXSB7XG5cdFx0bGV0IGRlcHMgPSB0aGlzLmFjY3VtdWxhdGVEZXBzKGZpbGUpO1xuXG5cdFx0Ly8gaGFjayB0byBzdXBwb3J0IGh0bWwgaW1wb3J0c1xuXHRcdGxldCBmaWxlbGlzdCA9IGRlcHMubWFwKChkZXApID0+IGRlcC5zb3VyY2VOYW1lKS5jb25jYXQoW19fSFRNTF9NT0RVTEVfX10pO1xuXHRcdGxldCBwcm9ncmFtID0gdHMuY3JlYXRlUHJvZ3JhbShmaWxlbGlzdCwgdGhpcy5fb3B0aW9ucywgdGhpcy5faG9zdCk7XG5cblx0XHRyZXR1cm4gZGVwcy5yZWR1Y2UoKGRpYWdzLCBkZXApID0+IHtcblx0XHRcdC8vIGRvbid0IGNoZWNrIHRoZSBkZWZhdWx0IGxpYiBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG5cdFx0XHRpZiAoIWRlcC5pc0RlZmF1bHRMaWIgJiYgIWRlcC5jaGVja2VkKSB7XG5cdFx0XHRcdGxldCBzb3VyY2VGaWxlID0gdGhpcy5faG9zdC5nZXRTb3VyY2VGaWxlKGRlcC5zb3VyY2VOYW1lKTtcblxuXHRcdFx0XHRkaWFncyA9IGRpYWdzXG5cdFx0XHRcdFx0LmNvbmNhdChwcm9ncmFtLmdldFN5bnRhY3RpY0RpYWdub3N0aWNzKHNvdXJjZUZpbGUpKVxuXHRcdFx0XHRcdC5jb25jYXQocHJvZ3JhbS5nZXRTZW1hbnRpY0RpYWdub3N0aWNzKHNvdXJjZUZpbGUpKTtcblxuXHRcdFx0XHRkZXAuY2hlY2tlZCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZGlhZ3M7XG5cdFx0fSwgcHJvZ3JhbS5nZXRHbG9iYWxEaWFnbm9zdGljcygpKTtcblx0fVxufVxuXG5jbGFzcyBEZWZlcnJlZDxUPiB7XG5cdHB1YmxpYyByZXNvbHZlOiAocmVzdWx0OiBUKSA9PiB2b2lkO1xuXHRwdWJsaWMgcmVqZWN0OiAoZXJyOiBFcnJvcikgPT4gdm9pZDtcblx0cHVibGljIHByb21pc2U6IFByb21pc2U8VD47XG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy5wcm9taXNlID0gbmV3IFByb21pc2U8VD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5yZXNvbHZlID0gcmVzb2x2ZTtcblx0XHRcdHRoaXMucmVqZWN0ID0gcmVqZWN0O1xuXHRcdH0pO1xuXHR9XG59XG4iXX0=