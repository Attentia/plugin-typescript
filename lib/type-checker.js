var ts = require('typescript');
var logger_1 = require('./logger');
var utils_1 = require("./utils");
var compiler_host_1 = require("./compiler-host");
var logger = new logger_1.default({ debug: false });
var TypeChecker = (function () {
    function TypeChecker(host, resolve, fetch) {
        this._host = host;
        this._resolve = resolve;
        this._fetch = fetch;
        this._options = Object.assign({}, this._host.options);
        this._options.inlineSourceMap = false;
        this._options.sourceMap = false;
        this._options.declaration = false;
        this._options.isolatedModules = false;
        this._options.skipDefaultLibCheck = true;
        this._files = new Map();
        this._declarationFiles = [];
    }
    TypeChecker.prototype.check = function (sourceName, source) {
        var file = this.registerFile(sourceName);
        this.registerSource(sourceName, source);
        return file.errors;
    };
    TypeChecker.prototype.registerDeclarationFile = function (sourceName, isDefaultLib) {
        var file = this.registerFile(sourceName, isDefaultLib);
        this._declarationFiles.push(file);
    };
    TypeChecker.prototype.registerFile = function (sourceName, isDefaultLib) {
        var _this = this;
        if (isDefaultLib === void 0) { isDefaultLib = false; }
        if (!this._files[sourceName]) {
            var source = new Deferred();
            if (utils_1.isTypescriptDeclaration(sourceName)) {
                this._fetch(sourceName)
                    .then(function (source) {
                    _this._host.addFile(sourceName, source, isDefaultLib);
                    _this.registerSource(sourceName, source);
                });
            }
            var loaded = source.promise
                .then(function (source) { return _this.resolveDependencies(sourceName, source); })
                .then(function (depsMap) {
                _this._host.addResolutionMap(sourceName, depsMap);
                _this._files[sourceName].deps = Object.keys(depsMap)
                    .map(function (key) { return depsMap[key]; })
                    .filter(function (res) { return utils_1.isTypescript(res); })
                    .map(function (res) { return _this.registerFile(res); })
                    .concat(_this._declarationFiles);
            });
            var errors = loaded
                .then(function () { return _this.canEmit(_this._files[sourceName]); })
                .then(function () { return _this.getAllDiagnostics(_this._files[sourceName]); });
            this._files[sourceName] = {
                sourceName: sourceName,
                source: source,
                loaded: loaded,
                errors: errors,
                checked: false,
            };
        }
        return this._files[sourceName];
    };
    TypeChecker.prototype.registerSource = function (sourceName, source) {
        if (!this._files[sourceName])
            throw new Error(sourceName + " has not been registered");
        this._files[sourceName].source.resolve(source);
    };
    TypeChecker.prototype.resolveDependencies = function (sourceName, source) {
        var _this = this;
        var info = ts.preProcessFile(source, true);
        var references = info.referencedFiles
            .map(function (ref) {
            if ((utils_1.isAmbient(ref.fileName) && !_this._options.resolveAmbientRefs) || (ref.fileName.indexOf("/") == -1))
                return "./" + ref.fileName;
            else
                return ref.fileName;
        });
        var imports = info.importedFiles
            .map(function (imp) { return imp.fileName; });
        var refs = [].concat(references).concat(imports);
        var deps = refs.map(function (ref) { return _this._resolve(ref, sourceName); });
        return Promise.all(deps)
            .then(function (resolved) {
            return refs.reduce(function (result, ref, idx) {
                result[ref] = resolved[idx];
                return result;
            }, {});
        });
    };
    TypeChecker.prototype.canEmit = function (file, seen) {
        var _this = this;
        seen = seen || [];
        if (seen.indexOf(file) < 0) {
            seen.push(file);
            return file.loaded.then(function () { return Promise.all(file.deps.map(function (dep) { return _this.canEmit(dep, seen); })); });
        }
    };
    TypeChecker.prototype.accumulateDeps = function (file, result) {
        var _this = this;
        result = result || [];
        if (result.indexOf(file) < 0) {
            result.push(file);
            file.deps.forEach(function (dep) { return _this.accumulateDeps(dep, result); });
        }
        return result;
    };
    TypeChecker.prototype.getAllDiagnostics = function (file) {
        var _this = this;
        var deps = this.accumulateDeps(file);
        var filelist = deps.map(function (dep) { return dep.sourceName; }).concat([compiler_host_1.__HTML_MODULE__]);
        var program = ts.createProgram(filelist, this._options, this._host);
        return deps.reduce(function (diags, dep) {
            if (!dep.checked) {
                var sourceFile = _this._host.getSourceFile(dep.sourceName);
                diags = diags
                    .concat(program.getSyntacticDiagnostics(sourceFile))
                    .concat(program.getSemanticDiagnostics(sourceFile));
                dep.checked = true;
            }
            return diags;
        }, program.getGlobalDiagnostics());
    };
    return TypeChecker;
})();
exports.TypeChecker = TypeChecker;
var Deferred = (function () {
    function Deferred() {
        var _this = this;
        this.promise = new Promise(function (resolve, reject) {
            _this.resolve = resolve;
            _this.reject = reject;
        });
    }
    return Deferred;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZS1jaGVja2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3R5cGUtY2hlY2tlci50cyJdLCJuYW1lcyI6WyJUeXBlQ2hlY2tlciIsIlR5cGVDaGVja2VyLmNvbnN0cnVjdG9yIiwiVHlwZUNoZWNrZXIuY2hlY2siLCJUeXBlQ2hlY2tlci5yZWdpc3RlckRlY2xhcmF0aW9uRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyRmlsZSIsIlR5cGVDaGVja2VyLnJlZ2lzdGVyU291cmNlIiwiVHlwZUNoZWNrZXIucmVzb2x2ZURlcGVuZGVuY2llcyIsIlR5cGVDaGVja2VyLmNhbkVtaXQiLCJUeXBlQ2hlY2tlci5hY2N1bXVsYXRlRGVwcyIsIlR5cGVDaGVja2VyLmdldEFsbERpYWdub3N0aWNzIiwiRGVmZXJyZWQiLCJEZWZlcnJlZC5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBWSxFQUFFLFdBQU0sWUFBWSxDQUFDLENBQUE7QUFDakMsdUJBQW1CLFVBQVUsQ0FBQyxDQUFBO0FBRzlCLHNCQUErRCxTQUFTLENBQUMsQ0FBQTtBQUN6RSw4QkFBOEIsaUJBQWlCLENBQUMsQ0FBQTtBQUVoRCxJQUFJLE1BQU0sR0FBRyxJQUFJLGdCQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztBQVcxQztJQVFDQSxxQkFBWUEsSUFBa0JBLEVBQUVBLE9BQXdCQSxFQUFFQSxLQUFvQkE7UUFDN0VDLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2xCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN4QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFFaEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLENBQUNB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QSxDQUFDQSxDQUFDQTtJQUNKQSxDQUFDQTtJQUNGRCxlQUFDQTtBQUFEQSxDQUFDQSxBQVhELElBV0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqL1xuaW1wb3J0ICogYXMgdHMgZnJvbSAndHlwZXNjcmlwdCc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7Q29tcGlsZXJIb3N0LCBDb21iaW5lZE9wdGlvbnN9IGZyb20gJy4vY29tcGlsZXItaG9zdCc7XG5pbXBvcnQge2Zvcm1hdEVycm9yc30gZnJvbSAnLi9mb3JtYXQtZXJyb3JzJztcbmltcG9ydCB7aXNUeXBlc2NyaXB0LCBpc1R5cGVzY3JpcHREZWNsYXJhdGlvbiwgaXNBbWJpZW50fSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtfX0hUTUxfTU9EVUxFX199IGZyb20gXCIuL2NvbXBpbGVyLWhvc3RcIjtcblxubGV0IGxvZ2dlciA9IG5ldyBMb2dnZXIoeyBkZWJ1ZzogZmFsc2UgfSk7XG5cbmludGVyZmFjZSBGaWxlRW50cnkge1xuXHRzb3VyY2VOYW1lOiBzdHJpbmc7XG5cdHNvdXJjZTogRGVmZXJyZWQ8c3RyaW5nPjtcblx0ZGVwcz86IEZpbGVFbnRyeVtdO1xuXHRsb2FkZWQ6IFByb21pc2U8YW55Pjtcblx0ZXJyb3JzOiBQcm9taXNlPHRzLkRpYWdub3N0aWNbXT47XG5cdGNoZWNrZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBUeXBlQ2hlY2tlciB7XG5cdHByaXZhdGUgX2hvc3Q6IENvbXBpbGVySG9zdDtcblx0cHJpdmF0ZSBfcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uO1xuXHRwcml2YXRlIF9mZXRjaDogRmV0Y2hGdW5jdGlvbjtcbiAgIHByaXZhdGUgX29wdGlvbnM6IENvbWJpbmVkT3B0aW9ucztcblx0cHJpdmF0ZSBfZmlsZXM6IE1hcDxzdHJpbmcsIEZpbGVFbnRyeT47XG5cdHByaXZhdGUgX2RlY2xhcmF0aW9uRmlsZXM6IEZpbGVFbnRyeVtdO1xuXG5cdGNvbnN0cnVjdG9yKGhvc3Q6IENvbXBpbGVySG9zdCwgcmVzb2x2ZTogUmVzb2x2ZUZ1bmN0aW9uLCBmZXRjaDogRmV0Y2hGdW5jdGlvbikge1xuXHRcdHRoaXMuX2hvc3QgPSBob3N0O1xuXHRcdHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xuXHRcdHRoaXMuX2ZldGNoID0gZmV0Y2g7XG5cbiAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9ob3N0Lm9wdGlvbnMpO1xuXHRcdHRoaXMuX29wdGlvbnMuaW5saW5lU291cmNlTWFwID0gZmFsc2U7XG5cdFx0dGhpcy5fb3B0aW9ucy5zb3VyY2VNYXAgPSBmYWxzZTtcblx0XHR0aGlzLl9vcHRpb25zLmRlY2xhcmF0aW9uID0gZmFsc2U7XG5cdFx0dGhpcy5fb3B0aW9ucy5pc29sYXRlZE1vZHVsZXMgPSBmYWxzZTtcblx0XHR0aGlzLl9vcHRpb25zLnNraXBEZWZhdWx0TGliQ2hlY2sgPSB0cnVlOyAvLyBkb24ndCBjaGVjayB0aGUgZGVmYXVsdCBsaWIgZm9yIGJldHRlciBwZXJmb3JtYW5jZVxuXG5cdFx0Ly8gbWFwIG9mIGFsbCB0eXBlc2NyaXB0IGZpbGVzIC0+IGZpbGUtZW50cnlcblx0XHR0aGlzLl9maWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBGaWxlRW50cnk+KCk7XG5cblx0XHQvLyBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIGRlY2xhcmF0aW9uIGZpbGVzXG5cdFx0dGhpcy5fZGVjbGFyYXRpb25GaWxlcyA9IFtdO1xuXHR9XG5cblx0Lypcblx0XHRyZXR1cm5zIGEgcHJvbWlzZSB0byBhbiBhcnJheSBvZiB0eXBlc2NyaXB0IGVycm9ycyBmb3IgdGhpcyBmaWxlXG5cdCovXG5cdHB1YmxpYyBjaGVjayhzb3VyY2VOYW1lOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKTogUHJvbWlzZTx0cy5EaWFnbm9zdGljW10+IHtcblx0XHR2YXIgZmlsZSA9IHRoaXMucmVnaXN0ZXJGaWxlKHNvdXJjZU5hbWUpO1xuXHRcdHRoaXMucmVnaXN0ZXJTb3VyY2Uoc291cmNlTmFtZSwgc291cmNlKTtcblx0XHRyZXR1cm4gZmlsZS5lcnJvcnM7XG5cdH1cblxuXHQvKlxuXHRcdHJlZ2lzdGVyIGRlY2xhcmF0aW9uIGZpbGVzIGZyb20gY29uZmlnXG5cdCovXG5cdHB1YmxpYyByZWdpc3RlckRlY2xhcmF0aW9uRmlsZShzb3VyY2VOYW1lOiBzdHJpbmcsIGlzRGVmYXVsdExpYjogYm9vbGVhbikge1xuXHRcdGxldCBmaWxlID0gdGhpcy5yZWdpc3RlckZpbGUoc291cmNlTmFtZSwgaXNEZWZhdWx0TGliKTtcblx0XHR0aGlzLl9kZWNsYXJhdGlvbkZpbGVzLnB1c2goZmlsZSk7XG5cdH1cblxuXHQvKiBwcml2YXRlICovXG5cblx0cHJpdmF0ZSByZWdpc3RlckZpbGUoc291cmNlTmFtZTogc3RyaW5nLCBpc0RlZmF1bHRMaWI6IGJvb2xlYW4gPSBmYWxzZSk6IEZpbGVFbnRyeSB7XG5cdFx0aWYgKCF0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSkge1xuXHRcdFx0bGV0IHNvdXJjZSA9IG5ldyBEZWZlcnJlZDxzdHJpbmc+KCk7XG5cblx0XHRcdC8qIHdlIG5lZWQgdG8gZmV0Y2ggZGVjbGFyYXRpb24gZmlsZXMgb3Vyc2VsdmVzICovXG5cdFx0XHRpZiAoaXNUeXBlc2NyaXB0RGVjbGFyYXRpb24oc291cmNlTmFtZSkpIHtcblx0XHRcdFx0dGhpcy5fZmV0Y2goc291cmNlTmFtZSlcblx0XHRcdFx0XHQudGhlbigoc291cmNlKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLl9ob3N0LmFkZEZpbGUoc291cmNlTmFtZSwgc291cmNlLCBpc0RlZmF1bHRMaWIpO1xuXHRcdFx0XHRcdFx0dGhpcy5yZWdpc3RlclNvdXJjZShzb3VyY2VOYW1lLCBzb3VyY2UpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiBsb2FkZWQgaXMgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gdGhlIHNvdXJjZSBoYXMgYmVlbiBhZGRlZCB0byB0aGVcblx0XHRcdFx0aG9zdCBhbmQgYWxsIHRoZSBkZXBlbmRlbmNpZXMgdXNlZCBieSB0aGlzIGZpbGUgaGF2ZSBiZWVuIHJlc29sdmVkICovXG5cdFx0XHRsZXQgbG9hZGVkID0gc291cmNlLnByb21pc2Vcblx0XHRcdFx0LnRoZW4oKHNvdXJjZSkgPT4gdGhpcy5yZXNvbHZlRGVwZW5kZW5jaWVzKHNvdXJjZU5hbWUsIHNvdXJjZSkpXG5cdFx0XHRcdC50aGVuKChkZXBzTWFwKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5faG9zdC5hZGRSZXNvbHV0aW9uTWFwKHNvdXJjZU5hbWUsIGRlcHNNYXApO1xuXG5cdFx0XHRcdFx0dGhpcy5fZmlsZXNbc291cmNlTmFtZV0uZGVwcyA9IE9iamVjdC5rZXlzKGRlcHNNYXApXG5cdFx0XHRcdFx0XHQubWFwKChrZXkpID0+IGRlcHNNYXBba2V5XSlcblx0XHRcdFx0XHRcdC5maWx0ZXIoKHJlcykgPT4gaXNUeXBlc2NyaXB0KHJlcykpIC8vIGlnbm9yZSBlLmcuIGNzcyBmaWxlc1xuXHRcdFx0XHRcdFx0Lm1hcCgocmVzKSA9PiB0aGlzLnJlZ2lzdGVyRmlsZShyZXMpKVxuXHRcdFx0XHRcdFx0LmNvbmNhdCh0aGlzLl9kZWNsYXJhdGlvbkZpbGVzKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdC8qIGVycm9ycyBpcyBhIHByb21pc2UgdG8gdGhlIGNvbXBpbGF0aW9uIHJlc3VsdHMgKi9cblx0XHRcdGxldCBlcnJvcnMgPSBsb2FkZWRcblx0XHRcdFx0LnRoZW4oKCkgPT4gdGhpcy5jYW5FbWl0KHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdKSlcblx0XHRcdFx0LnRoZW4oKCkgPT4gdGhpcy5nZXRBbGxEaWFnbm9zdGljcyh0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSkpO1xuXG5cdFx0XHR0aGlzLl9maWxlc1tzb3VyY2VOYW1lXSA9IHtcblx0XHRcdFx0c291cmNlTmFtZSxcblx0XHRcdFx0c291cmNlLFxuXHRcdFx0XHRsb2FkZWQsXG5cdFx0XHRcdGVycm9ycyxcblx0XHRcdFx0Y2hlY2tlZDogZmFsc2UsXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLl9maWxlc1tzb3VyY2VOYW1lXTtcblx0fVxuXG5cdHByaXZhdGUgcmVnaXN0ZXJTb3VyY2Uoc291cmNlTmFtZTogc3RyaW5nLCBzb3VyY2U6IHN0cmluZykge1xuXHRcdGlmICghdGhpcy5fZmlsZXNbc291cmNlTmFtZV0pXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYCR7c291cmNlTmFtZX0gaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWRgKTtcblxuXHRcdHRoaXMuX2ZpbGVzW3NvdXJjZU5hbWVdLnNvdXJjZS5yZXNvbHZlKHNvdXJjZSk7XG5cdH1cblxuXHQvKlxuXHRcdHByb2Nlc3MgdGhlIHNvdXJjZSB0byBnZXQgaXRzIGRlcGVuZGVuY2llcyBhbmQgcmVzb2x2ZSBhbmQgcmVnaXN0ZXIgdGhlbVxuXHRcdHJldHVybnMgYSBwcm9taXNlIHRvIHRoZSBsaXN0IG9mIHJlZ2lzdGVyZWQgZGVwZW5kZW5jeSBmaWxlc1xuXHQqL1xuXHRwcml2YXRlIHJlc29sdmVEZXBlbmRlbmNpZXMoc291cmNlTmFtZTogc3RyaW5nLCBzb3VyY2U6IHN0cmluZyk6IFByb21pc2U8TWFwPHN0cmluZywgc3RyaW5nPj4ge1xuXHRcdGxldCBpbmZvID0gdHMucHJlUHJvY2Vzc0ZpbGUoc291cmNlLCB0cnVlKTtcblxuXHRcdC8qIGJ1aWxkIHRoZSBsaXN0IG9mIGZpbGVzIHdlIG5lZWQgdG8gcmVzb2x2ZSAqL1xuXHRcdC8qIHJlZmVyZW5jZXMgZmlyc3QgKi9cblx0XHRsZXQgcmVmZXJlbmNlcyA9IGluZm8ucmVmZXJlbmNlZEZpbGVzXG5cdFx0XHQubWFwKChyZWYpID0+IHtcblx0XHRcdFx0aWYgKChpc0FtYmllbnQocmVmLmZpbGVOYW1lKSAmJiAhdGhpcy5fb3B0aW9ucy5yZXNvbHZlQW1iaWVudFJlZnMpIHx8IChyZWYuZmlsZU5hbWUuaW5kZXhPZihcIi9cIikgPT0gLTEpKVxuXHRcdFx0XHRcdHJldHVybiBcIi4vXCIgKyByZWYuZmlsZU5hbWU7XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRyZXR1cm4gcmVmLmZpbGVOYW1lO1xuXHRcdFx0fSk7XG5cblx0XHQvKiBub3cgaW1wb3J0cyAqL1xuXHRcdGxldCBpbXBvcnRzID0gaW5mby5pbXBvcnRlZEZpbGVzXG5cdFx0XHQubWFwKChpbXApID0+IGltcC5maWxlTmFtZSk7XG5cblx0XHRsZXQgcmVmcyA9IFtdLmNvbmNhdChyZWZlcmVuY2VzKS5jb25jYXQoaW1wb3J0cyk7XG5cblx0XHQvKiBjb252ZXJ0IHRvIGxpc3Qgb2YgcHJvbWlzZXMgdG8gcmVzb2x2ZWQgYWRkcmVzc2VzICovXG5cdFx0bGV0IGRlcHMgPSByZWZzLm1hcCgocmVmKSA9PiB0aGlzLl9yZXNvbHZlKHJlZiwgc291cmNlTmFtZSkpO1xuXG5cdFx0LyogYW5kIGNvbnZlcnQgdG8gcHJvbWlzZSB0byBhIG1hcCBvZiBsb2NhbCByZWZlcmVuY2UgdG8gcmVzb2x2ZWQgZGVwZW5kZW5jeSAqL1xuXHRcdHJldHVybiBQcm9taXNlLmFsbChkZXBzKVxuXHRcdFx0LnRoZW4oKHJlc29sdmVkKSA9PiB7XG5cdFx0XHRcdHJldHVybiByZWZzLnJlZHVjZSgocmVzdWx0LCByZWYsIGlkeCkgPT4ge1xuXHRcdFx0XHRcdHJlc3VsdFtyZWZdID0gcmVzb2x2ZWRbaWR4XTtcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9LCB7fSk7XG5cdFx0XHR9KTtcblx0fVxuXG5cdC8qXG5cdFx0cmV0dXJucyBwcm9taXNlIHJlc29sdmVkIHdoZW4gZmlsZSBjYW4gYmUgZW1pdHRlZFxuXHQqL1xuXHRwcml2YXRlIGNhbkVtaXQoZmlsZTogRmlsZUVudHJ5LCBzZWVuPzogRmlsZUVudHJ5W10pOiBQcm9taXNlPGFueT4ge1xuXHRcdC8qIGF2b2lkIGNpcmN1bGFyIHJlZmVyZW5jZXMgKi9cblx0XHRzZWVuID0gc2VlbiB8fCBbXTtcblxuXHRcdGlmIChzZWVuLmluZGV4T2YoZmlsZSkgPCAwKSB7XG5cdFx0XHRzZWVuLnB1c2goZmlsZSk7XG5cblx0XHRcdHJldHVybiBmaWxlLmxvYWRlZC50aGVuKCgpID0+IFByb21pc2UuYWxsKGZpbGUuZGVwcy5tYXAoKGRlcCkgPT4gdGhpcy5jYW5FbWl0KGRlcCwgc2VlbikpKSk7XG5cdFx0fVxuXHR9XG5cblx0Lypcblx0XHRSZXR1cm5zIGEgZmxhdHRlbmVkIGxpc3Qgb2YgdGhlIGRlcGVuZGVuY3kgdHJlZSBmb3IgdGhpcyBmaWxlLlxuXHQqL1xuXHRwcml2YXRlIGFjY3VtdWxhdGVEZXBzKGZpbGU6IEZpbGVFbnRyeSwgcmVzdWx0PzogRmlsZUVudHJ5W10pOiBGaWxlRW50cnlbXSB7XG5cdFx0cmVzdWx0ID0gcmVzdWx0IHx8IFtdO1xuXG5cdFx0aWYgKHJlc3VsdC5pbmRleE9mKGZpbGUpIDwgMCkge1xuXHRcdFx0cmVzdWx0LnB1c2goZmlsZSk7XG5cdFx0XHRmaWxlLmRlcHMuZm9yRWFjaCgoZGVwKSA9PiB0aGlzLmFjY3VtdWxhdGVEZXBzKGRlcCwgcmVzdWx0KSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdC8qXG5cdFx0UmV0dXJucyB0aGUgZGlhZ25vc3RpY3MgZm9yIHRoaXMgZmlsZSBhbmQgYW55IGZpbGVzIHdoaWNoIGl0IHVzZXMuXG5cdFx0RWFjaCBmaWxlIGlzIG9ubHkgY2hlY2tlZCBvbmNlLlxuXHQqL1xuXHRwcml2YXRlIGdldEFsbERpYWdub3N0aWNzKGZpbGU6IEZpbGVFbnRyeSk6IHRzLkRpYWdub3N0aWNbXSB7XG5cdFx0bGV0IGRlcHMgPSB0aGlzLmFjY3VtdWxhdGVEZXBzKGZpbGUpO1xuXG5cdFx0Ly8gaGFjayB0byBzdXBwb3J0IGh0bWwgaW1wb3J0c1xuXHRcdGxldCBmaWxlbGlzdCA9IGRlcHMubWFwKChkZXApID0+IGRlcC5zb3VyY2VOYW1lKS5jb25jYXQoW19fSFRNTF9NT0RVTEVfX10pO1xuXHRcdGxldCBwcm9ncmFtID0gdHMuY3JlYXRlUHJvZ3JhbShmaWxlbGlzdCwgdGhpcy5fb3B0aW9ucywgdGhpcy5faG9zdCk7XG5cblx0XHRyZXR1cm4gZGVwcy5yZWR1Y2UoKGRpYWdzLCBkZXApID0+IHtcblx0XHRcdGlmICghZGVwLmNoZWNrZWQpIHtcblx0XHRcdFx0bGV0IHNvdXJjZUZpbGUgPSB0aGlzLl9ob3N0LmdldFNvdXJjZUZpbGUoZGVwLnNvdXJjZU5hbWUpO1xuXG5cdFx0XHRcdGRpYWdzID0gZGlhZ3Ncblx0XHRcdFx0XHQuY29uY2F0KHByb2dyYW0uZ2V0U3ludGFjdGljRGlhZ25vc3RpY3Moc291cmNlRmlsZSkpXG5cdFx0XHRcdFx0LmNvbmNhdChwcm9ncmFtLmdldFNlbWFudGljRGlhZ25vc3RpY3Moc291cmNlRmlsZSkpO1xuXG5cdFx0XHRcdGRlcC5jaGVja2VkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBkaWFncztcblx0XHR9LCBwcm9ncmFtLmdldEdsb2JhbERpYWdub3N0aWNzKCkpO1xuXHR9XG59XG5cbmNsYXNzIERlZmVycmVkPFQ+IHtcblx0cHVibGljIHJlc29sdmU6IChyZXN1bHQ6IFQpID0+IHZvaWQ7XG5cdHB1YmxpYyByZWplY3Q6IChlcnI6IEVycm9yKSA9PiB2b2lkO1xuXHRwdWJsaWMgcHJvbWlzZTogUHJvbWlzZTxUPjtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZTxUPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuXHRcdFx0dGhpcy5yZWplY3QgPSByZWplY3Q7XG5cdFx0fSk7XG5cdH1cbn1cbiJdfQ==