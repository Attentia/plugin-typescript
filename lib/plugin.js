System.register(['typescript', './logger', './factory', './format-errors', './utils'], function(exports_1) {
    var ts, logger_1, factory_1, format_errors_1, utils_1;
    var logger, factory;
    function translate(load) {
        var _this = this;
        logger.debug("systemjs translating " + load.address);
        return factory.then(function (_a) {
            var transpiler = _a.transpiler, resolver = _a.resolver, typeChecker = _a.typeChecker, host = _a.host;
            host.addFile(load.address, load.source);
            if (utils_1.isTypescriptDeclaration(load.address)) {
                load.source = "";
            }
            else {
                var result = transpiler.transpile(load.address);
                format_errors_1.formatErrors(result.errors, logger);
                if (result.failure)
                    throw new Error("TypeScript transpilation failed");
                if (_this.loader && (host.options.module === 4))
                    load.source = wrapSource(result.js, load);
                else
                    load.source = result.js;
                if (result.sourceMap) {
                    if (_this.transpiler && _this.transpiler.indexOf("babel") >= 0)
                        load.metadata.sourceMap = JSON.parse(result.sourceMap);
                    else
                        load.metadata.sourceMap = result.sourceMap;
                }
                if (host.options.module === 4)
                    load.metadata.format = 'register';
                else if (host.options.module === 5)
                    load.metadata.format = 'esm';
            }
            if (host.options.typeCheck && utils_1.isTypescript(load.address)) {
                return resolver.resolve(load.address)
                    .then(function (deps) {
                    var diags = typeChecker.check();
                    format_errors_1.formatErrors(diags, logger);
                    load.metadata.deps = deps.list.filter(utils_1.isTypescriptDeclaration).map(function (d) { return d + "!"; });
                    return load.source;
                });
            }
            else {
                return load.source;
            }
        });
    }
    exports_1("translate", translate);
    function wrapSource(source, load) {
        return '(function(__moduleName){' + source + '\n})("' + load.name + '");\n//# sourceURL=' + load.address + '!transpiled';
    }
    function bundle() {
        return factory.then(function (_a) {
            var typeChecker = _a.typeChecker, host = _a.host;
            if (host.options.typeCheck) {
                var errors = typeChecker.forceCheck();
                if (errors.length > 0) {
                    format_errors_1.formatErrors(errors, logger);
                    if (host.options.typeCheck === "strict")
                        throw new Error("Typescript compilation failed");
                }
            }
            return [];
        });
    }
    exports_1("bundle", bundle);
    function _resolve(dep, parent) {
        return System.normalize(dep, parent)
            .then(function (normalized) {
            normalized = utils_1.stripDoubleExtension(normalized);
            logger.debug("resolved " + normalized + " (" + parent + " -> " + dep + ")");
            return normalized;
        });
    }
    function _fetch(address) {
        return System.fetch({ address: address, name: address, metadata: {} })
            .then(function (text) {
            logger.debug("fetched " + address);
            return text;
        });
    }
    return {
        setters:[
            function (ts_1) {
                ts = ts_1;
            },
            function (logger_1_1) {
                logger_1 = logger_1_1;
            },
            function (factory_1_1) {
                factory_1 = factory_1_1;
            },
            function (format_errors_1_1) {
                format_errors_1 = format_errors_1_1;
            },
            function (utils_1_1) {
                utils_1 = utils_1_1;
            }],
        execute: function() {
            logger = new logger_1.default({ debug: false });
            factory = factory_1.createFactory(System.typescriptOptions, _resolve, _fetch);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2luLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3BsdWdpbi50cyJdLCJuYW1lcyI6WyJ0cmFuc2xhdGUiLCJ3cmFwU291cmNlIiwiYnVuZGxlIiwiX3Jlc29sdmUiLCJfZmV0Y2giXSwibWFwcGluZ3MiOiI7O1FBT00sTUFBTSxFQUNOLE9BQU87SUFRYixtQkFBMEIsSUFBWTtRQUF0Q0EsaUJBa0RDQTtRQWpEQUEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsMEJBQXdCQSxJQUFJQSxDQUFDQSxPQUFTQSxDQUFDQSxDQUFDQTtRQUVyREEsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsRUFBeUNBO2dCQUF4Q0EsVUFBVUEsa0JBQUVBLFFBQVFBLGdCQUFFQSxXQUFXQSxtQkFBRUEsSUFBSUE7WUFDeERBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBR3hDQSxFQUFFQSxDQUFDQSxDQUFDQSwrQkFBdUJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUN6Q0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDcEJBLENBQUNBO1lBQ0RBLElBQUlBLENBQUNBLENBQUNBO2dCQUNIQSxJQUFNQSxNQUFNQSxHQUFHQSxVQUFVQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtnQkFDbERBLDRCQUFZQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtnQkFFcENBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBO29CQUNoQkEsTUFBTUEsSUFBSUEsS0FBS0EsQ0FBQ0EsaUNBQWlDQSxDQUFDQSxDQUFDQTtnQkFFdERBLEVBQUVBLENBQUNBLENBQUNBLEtBQUlBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEtBQUtBLENBQW9CQSxDQUFDQSxDQUFDQTtvQkFDL0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO2dCQUM3Q0EsSUFBSUE7b0JBQ0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBLEVBQUVBLENBQUNBO2dCQUUzQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3BCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxLQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTt3QkFDMURBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO29CQUMxREEsSUFBSUE7d0JBQ0RBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFNBQVNBLEdBQUdBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBO2dCQUNqREEsQ0FBQ0E7Z0JBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEtBQUtBLENBQW9CQSxDQUFDQTtvQkFDOUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEdBQUdBLFVBQVVBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBaUJBLENBQUNBO29CQUNoREEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFDbkNBLENBQUNB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QWdCLE9BQWU7UUFDOUJDLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLE9BQU9BLEVBQUVBLE9BQU9BLEVBQUVBLElBQUlBLEVBQUVBLE9BQU9BLEVBQUVBLFFBQVFBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBO2FBQ3BFQSxJQUFJQSxDQUFDQSxVQUFBQSxJQUFJQTtZQUNUQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFXQSxPQUFTQSxDQUFDQSxDQUFDQTtZQUNuQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDYkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7SUFDSkEsQ0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7WUE1R0ssTUFBTSxHQUFHLElBQUksZ0JBQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE9BQU8sR0FBRyx1QkFBYSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiAqL1xuaW1wb3J0ICogYXMgdHMgZnJvbSAndHlwZXNjcmlwdCc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7Y3JlYXRlRmFjdG9yeX0gZnJvbSAnLi9mYWN0b3J5JztcbmltcG9ydCB7Zm9ybWF0RXJyb3JzfSBmcm9tICcuL2Zvcm1hdC1lcnJvcnMnO1xuaW1wb3J0IHtpc1R5cGVzY3JpcHQsIGlzVHlwZXNjcmlwdERlY2xhcmF0aW9uLCBzdHJpcERvdWJsZUV4dGVuc2lvbn0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoeyBkZWJ1ZzogZmFsc2UgfSk7XG5jb25zdCBmYWN0b3J5ID0gY3JlYXRlRmFjdG9yeShTeXN0ZW0udHlwZXNjcmlwdE9wdGlvbnMsIF9yZXNvbHZlLCBfZmV0Y2gpO1xuXG4vKlxuICogbG9hZC5uYW1lXG4gKiBsb2FkLmFkZHJlc3NcbiAqIGxvYWQubWV0YWRhdGFcbiAqIGxvYWQuc291cmNlOiB0aGUgZmV0Y2hlZCBzb3VyY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zbGF0ZShsb2FkOiBNb2R1bGUpOiBQcm9taXNlPHN0cmluZz4ge1xuXHRsb2dnZXIuZGVidWcoYHN5c3RlbWpzIHRyYW5zbGF0aW5nICR7bG9hZC5hZGRyZXNzfWApO1xuXG5cdHJldHVybiBmYWN0b3J5LnRoZW4oKHt0cmFuc3BpbGVyLCByZXNvbHZlciwgdHlwZUNoZWNrZXIsIGhvc3R9KSA9PiB7XG4gICAgICBob3N0LmFkZEZpbGUobG9hZC5hZGRyZXNzLCBsb2FkLnNvdXJjZSk7XG5cbiAgICAgIC8vIHRyYW5zcGlsZVxuICAgICAgaWYgKGlzVHlwZXNjcmlwdERlY2xhcmF0aW9uKGxvYWQuYWRkcmVzcykpIHtcbiAgICAgICAgIGxvYWQuc291cmNlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgY29uc3QgcmVzdWx0ID0gdHJhbnNwaWxlci50cmFuc3BpbGUobG9hZC5hZGRyZXNzKTtcbiAgICAgICAgIGZvcm1hdEVycm9ycyhyZXN1bHQuZXJyb3JzLCBsb2dnZXIpO1xuXG4gICAgICAgICBpZiAocmVzdWx0LmZhaWx1cmUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUeXBlU2NyaXB0IHRyYW5zcGlsYXRpb24gZmFpbGVkXCIpO1xuXG4gICAgICAgICBpZiAodGhpcy5sb2FkZXIgJiYgKGhvc3Qub3B0aW9ucy5tb2R1bGUgPT09IHRzLk1vZHVsZUtpbmQuU3lzdGVtKSlcbiAgICAgICAgICAgIGxvYWQuc291cmNlID0gd3JhcFNvdXJjZShyZXN1bHQuanMsIGxvYWQpO1xuICAgICAgICAgZWxzZSBcbiAgICAgICAgICAgIGxvYWQuc291cmNlID0gcmVzdWx0LmpzO1xuICAgICAgICAgXG4gICAgICAgICBpZiAocmVzdWx0LnNvdXJjZU1hcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNwaWxlciAmJiB0aGlzLnRyYW5zcGlsZXIuaW5kZXhPZihcImJhYmVsXCIpID49IDApXG4gICAgICAgICAgICAgICBsb2FkLm1ldGFkYXRhLnNvdXJjZU1hcCA9IEpTT04ucGFyc2UocmVzdWx0LnNvdXJjZU1hcCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICBsb2FkLm1ldGFkYXRhLnNvdXJjZU1hcCA9IHJlc3VsdC5zb3VyY2VNYXA7XG4gICAgICAgICB9XG4gICAgICAgICBcbiAgICAgICAgIGlmIChob3N0Lm9wdGlvbnMubW9kdWxlID09PSB0cy5Nb2R1bGVLaW5kLlN5c3RlbSlcbiAgICAgICAgICAgIGxvYWQubWV0YWRhdGEuZm9ybWF0ID0gJ3JlZ2lzdGVyJztcbiAgICAgICAgIGVsc2UgaWYgKGhvc3Qub3B0aW9ucy5tb2R1bGUgPT09IHRzLk1vZHVsZUtpbmQuRVM2KVxuICAgICAgICAgICAgbG9hZC5tZXRhZGF0YS5mb3JtYXQgPSAnZXNtJztcdFx0XHRcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gdHlwZS1jaGVjaz9cbiAgICAgIGlmIChob3N0Lm9wdGlvbnMudHlwZUNoZWNrICYmIGlzVHlwZXNjcmlwdChsb2FkLmFkZHJlc3MpKSB7XG4gICAgICAgICByZXR1cm4gcmVzb2x2ZXIucmVzb2x2ZShsb2FkLmFkZHJlc3MpXG4gICAgICAgICAgICAudGhlbihkZXBzID0+IHtcbiAgICAgICAgICAgICAgIHZhciBkaWFncyA9IHR5cGVDaGVja2VyLmNoZWNrKCk7XG4gICAgICAgICAgICAgICBmb3JtYXRFcnJvcnMoZGlhZ3MsIGxvZ2dlcik7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgIGxvYWQubWV0YWRhdGEuZGVwcyA9IGRlcHMubGlzdC5maWx0ZXIoaXNUeXBlc2NyaXB0RGVjbGFyYXRpb24pLm1hcChkID0+IGQgKyBcIiFcIik7XG4gICAgICAgICAgICAgICByZXR1cm4gbG9hZC5zb3VyY2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgcmV0dXJuIGxvYWQuc291cmNlOyAgICAgICAgICAgICAgICAgIFxuICAgICAgfVxuICAgfSk7XG59XG5cbmZ1bmN0aW9uIHdyYXBTb3VyY2Uoc291cmNlOiBzdHJpbmcsIGxvYWQ6IE1vZHVsZSk6IHN0cmluZyB7XG5cdHJldHVybiAnKGZ1bmN0aW9uKF9fbW9kdWxlTmFtZSl7JyArIHNvdXJjZSArICdcXG59KShcIicgKyBsb2FkLm5hbWUgKyAnXCIpO1xcbi8vIyBzb3VyY2VVUkw9JyArIGxvYWQuYWRkcmVzcyArICchdHJhbnNwaWxlZCc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidW5kbGUoKSB7XG4gICByZXR1cm4gZmFjdG9yeS50aGVuKCh7dHlwZUNoZWNrZXIsIGhvc3R9KSA9PiB7XG4gICAgICBcbiAgICAgIGlmIChob3N0Lm9wdGlvbnMudHlwZUNoZWNrKSB7XG4gICAgICAgICBjb25zdCBlcnJvcnMgPSB0eXBlQ2hlY2tlci5mb3JjZUNoZWNrKCk7XG4gICAgICAgICBcbiAgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9ybWF0RXJyb3JzKGVycm9ycywgbG9nZ2VyKTtcblxuICAgICAgICAgICAgaWYgKGhvc3Qub3B0aW9ucy50eXBlQ2hlY2sgPT09IFwic3RyaWN0XCIpXG4gICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUeXBlc2NyaXB0IGNvbXBpbGF0aW9uIGZhaWxlZFwiKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgcmV0dXJuIFtdO1xuICAgfSk7XG59XG5cbi8qXG4gKiBjYWxsZWQgYnkgdGhlIGZhY3RvcnkvcmVzb2x2ZXIgd2hlbiBpdCBuZWVkcyB0byByZXNvbHZlIGEgZmlsZVxuICovXG5mdW5jdGlvbiBfcmVzb2x2ZShkZXA6IHN0cmluZywgcGFyZW50OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuXHQvLyBUT0RPOiBfX21vZHVsZU5hbWUgaXMgbm90IGF2YWlsYWJsZSB3aXRob3V0IGEgYnVpbHQtaW4gdHJhbnNwaWxlclxuXHQvL2lmICghcGFyZW50KSBwYXJlbnQgPSBfX21vZHVsZU5hbWU7XG5cblx0cmV0dXJuIFN5c3RlbS5ub3JtYWxpemUoZGVwLCBwYXJlbnQpXG5cdFx0LnRoZW4obm9ybWFsaXplZCA9PiB7XG5cdFx0XHRub3JtYWxpemVkID0gc3RyaXBEb3VibGVFeHRlbnNpb24obm9ybWFsaXplZCk7XG5cblx0XHRcdGxvZ2dlci5kZWJ1ZyhgcmVzb2x2ZWQgJHtub3JtYWxpemVkfSAoJHtwYXJlbnR9IC0+ICR7ZGVwfSlgKTtcblx0XHRcdHJldHVybiBub3JtYWxpemVkO1xuXHRcdH0pO1xufVxuXG4vKlxuICogY2FsbGVkIGJ5IHRoZSBmYWN0b3J5L3Jlc29sdmVyIHdoZW4gaXQgbmVlZHMgdG8gZmV0Y2ggYSBmaWxlXG4gKi9cbmZ1bmN0aW9uIF9mZXRjaChhZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuXHRyZXR1cm4gU3lzdGVtLmZldGNoKHsgYWRkcmVzczogYWRkcmVzcywgbmFtZTogYWRkcmVzcywgbWV0YWRhdGE6IHt9IH0pXG5cdFx0LnRoZW4odGV4dCA9PiB7XG5cdFx0XHRsb2dnZXIuZGVidWcoYGZldGNoZWQgJHthZGRyZXNzfWApO1xuXHRcdFx0cmV0dXJuIHRleHQ7XG5cdFx0fSlcbn1cbiJdfQ==